(this["webpackJsonpreact-tsapp"]=this["webpackJsonpreact-tsapp"]||[]).push([[0],{184:function(t,e,n){},194:function(t,e,n){},247:function(t,e,n){},271:function(t,e,n){"use strict";n.r(e);var c=n(0),a=n.n(c),i=n(25),r=n.n(i),o=(n(184),n(86)),s=n(29),l=n(69),u=n(70),d=n(78),j=n(77),h=(n(140),n(112)),b=(n(124),n(52)),f=(n(126),n(36)),O=n(49),p=(n(163),n(107)),g=n(40),x=(n(273),n(136)),m=(n(142),n(178)),v=(n(194),n(84)),w=n.n(v);function k(t,e){return new Promise((function(n,c){w.a.get(t,{params:e}).then((function(t){n(t.data)})).catch((function(t){c(t)}))}))}w.a.defaults.baseURL="http://localhost/",w.a.defaults.headers.common["Content-Type"]="application/json;charset=UTF-8",w.a.defaults.timeout=2e4;var S=function(t){return k("/api/downLoadAWorl",t)},y=function(t){return function(t,e){return new Promise((function(n,c){w.a.post(t,e).then((function(t){n(t.data)})).catch((function(t){c(t)}))}))}("/api/downLoadAll",t)},C=n(6),D=m.a.Search,N=x.a.Meta,A=function(t){var e=Object(c.useState)(""),n=Object(g.a)(e,2),a=n[0],i=n[1],r=Object(c.useState)(0),o=Object(g.a)(r,2),s=o[0],l=o[1],u=Object(c.useState)(1),d=Object(g.a)(u,2),j=d[0],h=d[1],b=Object(c.useState)(12),f=Object(g.a)(b,1)[0],O=t.changeList;Object(c.useEffect)((function(){x()}),[]);var x=function(){var t;(t={key:a,from:j,size:f},k("/api/pingccApi/search",t)).then((function(t){var e=t.data||{count:0,data:[]},n=e.count,c=e.data;l(n),O(c)}))};return Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(D,{placeholder:"\u8bf7\u8f93\u5165\u67e5\u8be2\u6761\u4ef6",allowClear:!0,style:{width:300},value:a,enterButton:"Search",onInput:function(t){i(t.target.value)},onSearch:function(){x()}}),Object(C.jsx)("div",{className:"content",children:t.children}),Object(C.jsx)(p.a,{className:"textAlignR",total:s,showTotal:function(t){return"\u603b\u5171 ".concat(t," \u672c")},defaultPageSize:f,defaultCurrent:j,onChange:function(t){h(t),x()}})]})},L=function(t){var e=t.dataList,n={xs:12,sm:8,md:6,lg:6,xl:4};return Object(C.jsx)(h.b,{children:Object(C.jsx)(b.a,{gutter:[20,20],children:e.map((function(t,e){return Object(c.createElement)(f.a,Object(O.a)(Object(O.a)({},n),{},{key:e}),Object(C.jsx)(I,Object(O.a)({},t)))}))})})},I=function(t){var e=Object(s.f)();return Object(C.jsx)(x.a,{hoverable:!0,onClick:function(){e.push({pathname:"/list/".concat(t.cartoonId,"/").concat(t.title)})},style:{width:"100%"},cover:Object(C.jsx)("img",{alt:"example",src:t.cover}),children:Object(C.jsx)(N,{title:t.title,description:t.descs})})},R=function(t){Object(d.a)(n,t);var e=Object(j.a)(n);function n(){var t;Object(l.a)(this,n);for(var c=arguments.length,a=new Array(c),i=0;i<c;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={dataList:[],pageIndex:1,count:0,pageSize:10},t.changeList=function(e){t.setState({dataList:e})},t}return Object(u.a)(n,[{key:"render",value:function(){return Object(C.jsx)("div",{className:"padding20",children:Object(C.jsx)(A,{changeList:this.changeList,children:Object(C.jsx)(L,{dataList:this.state.dataList})})})}}]),n}(c.Component),T=(n(217),n(170)),P=(n(274),n(174)),F=(n(222),n(138)),z=(n(224),n(177)),B=(n(272),n(172)),E=(n(232),n(85)),W=(n(235),n(173)),H=(n(237),n(175)),M=(n(239),n(176)),U=(n(241),n(137)),V=(n(154),n(92)),J=(n(243),n(171)),_=(n(67),n(28)),Y=(n(245),n(55)),q=(n(247),n(279));function G(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,n=!0;return function(){if(!n)return Y.b.warning("\u4e0d\u8981\u70b9\u51fb\u7684\u592a\u4f69\u670d\uff01"),!1;n=!1,t.apply(void 0,arguments),setTimeout((function(){n=!0}),e)}}var K=[],Q={height:40,width:40,lineHeight:"40px",borderRadius:4,backgroundColor:"#1088e9",color:"#fff",textAlign:"center",fontSize:14},X=function(t){var e=t.childRef,n=t.aDown,a=t.isNowDown,i=Object(c.useState)(!1),r=Object(g.a)(i,2),o=r[0],s=r[1],l=Object(c.useState)(""),u=Object(g.a)(l,2),d=u[0],j=u[1],h=Object(c.useState)([]),b=Object(g.a)(h,2),f=b[0],O=b[1],p=Object(c.useState)(!1),x=Object(g.a)(p,2),m=x[0],v=x[1],w=Object(c.useState)({}),S=Object(g.a)(w,2),y=S[0],D=S[1];Object(c.useImperativeHandle)(e,(function(){return{getValue:function(t){return N(t)}}}));var N=function(t){var e,n=t.title,c=t.chapterId;s(!0),j(n),O([]),v(!0),D(t),(e=c,k("/api/pingccApi/detail?chapterId=".concat(e))).then((function(t){O(t.data.data.content),v(!1)}))};return Object(C.jsx)(C.Fragment,{children:Object(C.jsx)(U.a,{title:d,placement:"right",width:window.innerWidth/4*3,closable:!1,onClose:function(){s(!1)},visible:o,footer:Object(C.jsx)("div",{style:{textAlign:"left"},children:Object(C.jsx)(_.a,{onClick:function(){return n(y)},disabled:a,type:"primary",icon:Object(C.jsx)(q.a,{}),children:"Download"})}),children:Object(C.jsx)(V.a,{spinning:m,children:f.map((function(t,e){return Object(C.jsx)(J.a,{preview:!1,width:window.innerWidth/4*3-70,src:t},e)}))})})})},Z=function(t){var e=t.childRef,n=t.setDownStatus,a=Object(c.useState)(!1),i=Object(g.a)(a,2),r=i[0],o=i[1],l=Object(c.useState)([]),u=Object(g.a)(l,2),d=u[0],j=u[1],h=Object(c.useState)(0),b=Object(g.a)(h,2),f=b[0],O=b[1],p=Object(s.f)();Object(c.useImperativeHandle)(e,(function(){return{getValue:function(t){return x(t)}}})),Object(c.useEffect)((function(){var t=new WebSocket("ws://localhost:8888/");t.onopen=function(){console.log("\u5df2\u8fde\u63a5...")},t.onmessage=function(t){var e=t.data,c=JSON.parse(e);c.message?(Y.b.success(c.message),K=[],n(),j([])):(O(Number(c.progress)),K.unshift("\u603b\u9875\u6570\uff1a".concat(c.allPage," , \u5df2\u4e0b\u8f7d\uff1a").concat(c.downPage," ")),j(K))},t.onclose=function(){console.log("\u8fde\u63a5\u5df2\u5173\u95ed..."),M.a.error({title:"\u8fde\u63a5\u5df2\u5173\u95ed",content:"\u670d\u52a1\u8fc7\u8f7d\uff0c\u5d29\u6389\u4e86\u3002\u8bf7\u91cd\u542f\u670d\u52a1\uff01\uff01"}),p.push({pathname:"/error"})}}),[]);var x=function(t){o(!0)};return Object(C.jsx)(C.Fragment,{children:Object(C.jsxs)(U.a,{title:"\u4e0b\u8f7d\u8fdb\u5ea6",placement:"right",width:window.innerWidth/4*3,closable:!1,onClose:function(){o(!1)},visible:r,children:[Object(C.jsx)("div",{className:"progressBox",children:Object(C.jsx)(H.a,{type:"circle",percent:f})}),Object(C.jsx)(E.b,{className:"progressList",itemLayout:"horizontal",dataSource:d,renderItem:function(t){return Object(C.jsx)(E.b.Item,{children:Object(C.jsx)(W.a.Text,{mark:!0,children:t})})}})]})})},$=function(t){Object(d.a)(n,t);var e=Object(j.a)(n);function n(){var t;Object(l.a)(this,n);for(var c=arguments.length,i=new Array(c),r=0;r<c;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).state={title:"Title",data:[],count:0,checkedArr:[],loading:!1,allDownLoading:!1,aDownThrottle:null,isAllChecked:!1,isNowDown:!1},t.childRef=a.a.createRef(),t.childProgressRef=a.a.createRef(),t.onChange=function(e,n,c){var a=t.state.data;a[c].checked=e.target.checked,t.setState({data:a,checkedArr:a.filter((function(t){return t.checked})).map((function(t){return{id:t.chapterId,title:t.title}}))})},t.onAllChange=function(e){var n=e.target.checked,c=t.state.data;c=c.map((function(t){return Object(O.a)(Object(O.a)({},t),{},{checked:n})})),t.setState({data:c,checkedArr:c.filter((function(t){return t.checked})).map((function(t){return{id:t.chapterId,title:t.title}})),isAllChecked:n})},t.aDown=function(e){S({id:e.chapterId,title:t.state.title,zj_tit:e.title}).then((function(e){200===e.code?(Y.b.success("\u5df2\u5f00\u59cb\u4e0b\u8f7d\uff01\uff01\uff01"),t.setState({isNowDown:!0})):Y.b.error(e.massage)}))},t.allDown=function(){var e=t.state,n=e.title,c=e.data,a=e.checkedArr;a.length?(t.setState({allDownLoading:!0}),y({title:n,arr:a}).then((function(){Y.b.success("\u5df2\u5f00\u59cb\u6279\u91cf\u4e0b\u8f7d\uff01\uff01\uff01"),t.setState({data:c.map((function(t){return Object(O.a)(Object(O.a)({},t),{},{checked:!1})})),allDownLoading:!1,isNowDown:!0,checkedArr:[],isAllChecked:!1})}))):Y.b.error("\u8bf7\u9009\u62e9\u8981\u4e0b\u8f7d\u7684\u6f2b\u753b\uff01")},t.detail=function(e){t.childRef.current.getValue(e)},t.getProgress=function(){t.childProgressRef.current.getValue()},t}return Object(u.a)(n,[{key:"UNSAFE_componentWillMount",value:function(){this.setState({aDownThrottle:G(this.aDown)})}},{key:"componentDidMount",value:function(){var t,e=this,n=this.props.match.params,c=n.id,a=n.title;this.setState({title:a,loading:!0}),(t=c,k("/api/pingccApi/list?cartoonId=".concat(t))).then((function(t){var n=t.data||{count:0,data:[]},c=n.count,a=n.data;e.setState({data:a.map((function(t){return Object(O.a)(Object(O.a)({},t),{},{checked:!1})})),count:c,loading:!1})}))}},{key:"render",value:function(){var t=this,e=this.state,n=e.checkedArr,c=e.allDownLoading,a=e.aDownThrottle,i=e.isAllChecked,r=e.isNowDown;return Object(C.jsxs)("div",{children:[Object(C.jsx)(B.a,{className:"site-page-header",onBack:function(){var e,n;return null===(e=t.props)||void 0===e||null===(n=e.history)||void 0===n?void 0:n.goBack()},title:this.state.title,extra:[Object(C.jsx)(_.a,{onClick:this.getProgress,type:"primary",children:"\u67e5\u770b\u4e0b\u8f7d\u8fdb\u5ea6"},"1")]}),Object(C.jsx)(X,{isNowDown:r,aDown:a,childRef:this.childRef}),Object(C.jsx)(Z,{setDownStatus:function(){t.setState({isNowDown:!1})},childRef:this.childProgressRef}),Object(C.jsx)(z.a,{children:Object(C.jsx)("div",{style:Q,children:"UP"})}),Object(C.jsxs)("div",{className:"affixClass",children:[Object(C.jsx)(F.a,{checked:i,onChange:this.onAllChange,children:"\u5168\u9009"}),Object(C.jsx)(P.a,{value:n.length,prefix:"\u5df2\u9009\u4e2d"}),Object(C.jsx)(T.a,{title:"\u786e\u5b9a\u6279\u91cf\u4e0b\u8f7d\u5417?",onConfirm:this.allDown,disabled:r,onCancel:function(){},okText:"Yes",cancelText:"No",children:Object(C.jsx)(_.a,{type:"primary",icon:Object(C.jsx)(q.a,{}),disabled:r,loading:c,children:"\u6279\u91cf\u4e0b\u8f7d"})})]}),Object(C.jsx)("div",{className:"padding24",children:Object(C.jsx)(V.a,{spinning:this.state.loading,children:Object(C.jsx)(E.b,{className:"demo-loadmore-list",itemLayout:"horizontal",dataSource:this.state.data,grid:{gutter:16,xs:1,sm:2,md:2,lg:3,xl:3,xxl:3},renderItem:function(e,n){return Object(C.jsx)(E.b.Item,{children:Object(C.jsxs)(b.a,{gutter:16,justify:"space-around",align:"middle",children:[Object(C.jsx)(f.a,{className:"gutter-row",span:2,children:Object(C.jsx)(F.a,{onChange:function(c){return t.onChange(c,e,n)},indeterminate:!1,checked:e.checked})}),Object(C.jsx)(f.a,{className:"gutter-row",span:10,children:Object(C.jsx)(E.b.Item.Meta,{title:e.title})}),Object(C.jsx)(f.a,{className:"gutter-row",span:10,children:Object(C.jsxs)(h.b,{className:"flexEnd",children:[Object(C.jsx)(_.a,{onClick:function(){return t.detail(e)},children:"\u67e5\u770b"}),Object(C.jsx)(_.a,{onClick:function(){return a(e)},disabled:r,type:"primary",icon:Object(C.jsx)(q.a,{})})]})})]})})}})})})]})}}]),n}(c.Component),tt=(n(269),n(179)),et=function(t){Object(d.a)(n,t);var e=Object(j.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var t=this;return Object(C.jsx)(tt.a,{status:"500",title:"500",subTitle:"Sorry, something went wrong.",extra:Object(C.jsx)(_.a,{type:"primary",onClick:function(){t.props.history.push("/")},children:"Back Home"})})}}]),n}(c.Component);function nt(){return Object(C.jsx)(o.a,{children:Object(C.jsx)("div",{children:Object(C.jsxs)(s.c,{children:[Object(C.jsx)(s.a,{path:"/list/:id/:title",component:$}),Object(C.jsx)(s.a,{path:"/error",component:et}),Object(C.jsx)(s.a,{path:"/",children:Object(C.jsx)(R,{})})]})})})}var ct=function(){return Object(C.jsx)(C.Fragment,{children:Object(C.jsx)(nt,{})})},at=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,280)).then((function(e){var n=e.getCLS,c=e.getFID,a=e.getFCP,i=e.getLCP,r=e.getTTFB;n(t),c(t),a(t),i(t),r(t)}))};r.a.render(Object(C.jsx)(ct,{}),document.getElementById("root")),at()}},[[271,1,2]]]);
//# sourceMappingURL=main.bd49114b.chunk.js.map